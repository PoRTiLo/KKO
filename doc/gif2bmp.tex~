\documentclass[a4paper, 10pt]{article}[5.10.2011]

%% packages
\usepackage[left=2cm, text={17cm, 24cm}, top=3cm]{geometry}		% rozmery stránky
\usepackage[czech]{babel}
\usepackage[latin2]{inputenc}
\usepackage[IL2]{fontenc}
\usepackage{colortbl}
\usepackage{listings}
\usepackage{lineno}




\renewcommand\lstlistingname{Pseudokód}
\renewcommand\lstlistlistingname{Pseudokód}
\def\lstlistingname{Pseudokód}
\lstset{ %
language=C,                   % the language of the code
basicstyle=\footnotesize,       % the size of the fonts that are used for the code
numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=1,                   % the step between two line-numbers. If it's 1, each line 
                                % will be numbered
numbersep=-10pt,                % how far the line-numbers are from the code
backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
frame=tb,                       % adds a frame around the code
tabsize=2,                      % sets default tabsize to 2 spaces
captionpos=b,                   % sets the caption-position to bottom
breaklines=true,                % sets automatic line breaking
breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
title=\lstname,                 % show the filename of files included with \lstinputlisting;
                                % also try caption instead of title
escapeinside={\%*}{*)},         % if you want to add a comment within your code
morekeywords={CODE,..., fakulta},            % if you want to add more keywords to the set
commentstyle=\color{gray}\upshape
}

\definecolor{gray}{rgb}{0.4,0.4,0.4}
\definecolor{darkblue}{rgb}{0.0,0.0,0.6}
\definecolor{cyan}{rgb}{0.0,0.6,0.6}
\lstdefinelanguage{C}
{
  morestring=[b]",
  morestring=[s]{>}{<},
  morecomment=[s]{/*}{*/},
  stringstyle=\color{black},
  identifierstyle=\color{darkblue},
  keywordstyle=\color{cyan},
  morekeywords={CODE,version,type, fakulty, titul, to, from, id, node}% list your attributes here
}


% =======================================================================
% balíèek "hyperref" vytváøí klikací odkazy v pdf, pokud tedy pou¾ijeme pdflatex
% problém je, ¾e balíèek hyperref musí být uveden jako poslední, tak¾e nemù¾e
% být v ¹ablonì
\ifWis
\ifx\pdfoutput\undefined % nejedeme pod pdflatexem
\else
  \usepackage{color}
  \usepackage[unicode,colorlinks,hyperindex,plainpages=false,pdftex]{hyperref}
  \definecolor{links}{rgb}{0.4,0.5,0}
  \definecolor{anchors}{rgb}{1,0,0}
  \def\AnchorColor{anchors}
  \def\LinkColor{links}
  \def\pdfBorderAttrs{/Border [0 0 0] }  % bez okrajù kolem odkazù
  \pdfcompresslevel=9
\fi
\fi
\ifx\du\undefined
  \newlength{\du}
\fi
\setlength{\du}{15\unitlength}





\title{Kódování a komprese\,--\,dokumentace \\gif2bmp}
\author{Bc. Jaroslav Sendler, xsendl00\\ xsendl00@stud.fit.vutbr.cz}
\date{\today}

\begin{document}
\maketitle

\section*{Knihovna}
Knihovna se stará o konverzi obrázku GIF na formát BMP. Jako vstup je akceptován jak verze gifu GIF89a tak i star¹í formát GIF87a. Výstupem je obrázek ve formátu BMP verze 3.
\subsection*{GIF}
Standard GIF89a obsahuje nìkolik povinných polo¾ek, které jsou spoleèné i pro star¹í verzi GIF87a. Pro tyto i dal¹í roz¹iøující bloky jsou vytvoøeny struktury reprezentující je. Pøi pøevodu na formát BMP jsou roz¹iøujícími bloky naplnìny odpovídající struktury, ale dále jsou ignorovány. Knihovna si poradí i s prokládanými obrázky. 

Pro dekompresi obrázku komprimovaného pomocí algoritmu LZW byl pou¾it kód popsaný pseudokódem \ref{LZW}. Pseudokód neobsahuje kontrolu pøeteèení velikosti slovníku a zvìt¹ování poètu naèítaných bitù. Poèáteèní velikost slovníku se nastaví podle následujícího výpoètu: \textit{velikost slovníku = poèet barev << 1}. Pøi naplnìní slovníku se provede døíve uvedený výpoèet a zvý¹í se poèet naèítaných bitù o jeden a¾ do velikosti 12. Pøi situaci, kdy by se mìlo naèítat 13 bitù je poèet sní¾en na 12 a následnì je oèekáván pøíchod hodnoty \textit{CC}, kód znaèící reinicializaci slovníku. Po tomto kroku se v¹e nastaví na poèáteèní hodnoty a pokraèuje se od zaèátku a¾ do pøíchodu indexu kódu \textit{EOI}.
\begin{figure}[ht]
\lstset{language=C,caption={LZW algoritmus - dekomprese},label=LZW}
\begin{lstlisting}
     inicializace slovníku
     naèti první kódové slovo CODE ze vstupu       /* CODE index do slovníku */
     výstup += {CODE}                              /* {CODE} obsah slovníku na daném indexu */
     while(vstup není prázdný) {
        naèti dal¹í kódové slovo CODE ze vstupu
        if(CODE je ve slovníku) {
           výstup += {CODE}
           K je první index z {CODE}
           pøidej {CODE - 1} + K do slovníku
        }
        else {                                     /* CODE není ve slovníku */
           K je první index z {CODE - 1}
           výstup += {CODE - 1} + K
           pøidej {CODE - 1} + K do slovníku
        }
     }
\end{lstlisting}
\end{figure}

Jako rozhraní pro pou¾ití knihovny v aplikacích je k dispozici následující funkce \textit{int gif2bmp(tGIF2BMP *gif2bmp, FILE *inputFile, FILE *outputFile)}, vracející 0 pøi úspì¹ném pøevodu nebo -1 pøi chybì. V pøípadì jakékoliv záva¾né chybì, pøi které pøevod nemù¾e probìhnout je na standardní chybový výstup vypsán informaèní log a aplikace je ukonèena

\subsection*{BMP - Microsoft Windows Bitmap}
Jako výstup je pou¾it obrázek typu BMP, je pou¾ita verze 3 (Microsoft Windows 3.x). Verze 3 bitmapy obsahuje tøi základní povinné sekce : bitmapovou hlavièku, informaèní hlavièku a bitmapu. Dal¹í èást mù¾e být paleta, je¾ je volitelná. Tato knihovna vyu¾ívá pouze povinné sekce, které jsou implementovány strukturami \textit{tBmpHeader} a \textit{tBmpInfoHeader}. Jeliko¾ je pou¾ito 24 bitù na pixel, není vyu¾ita barevná paleta, jeliko¾ pixelová barevná data jsou ulo¾ena pøímo v obrazových datech. Samotná obrazová data nejsou komprimována ¾ádným algoritmem. Tedy výstupní soubor je mnohem vìt¹í ne¾ vstupní obrázek GIF komprimovaný LZW algoritmem.

Ní¾e uvedené schéma \ref{pic} reprezentuje pou¾ité struktury v obrázku. První je Bitmapová hlavièka, která je následována Informaèní hlavièkou. Zbytek souboru tvoøí bitmapová data. V závorkách na koncích popisu schématu jsou uvedena data (nemìnná), je¾ jsou pou¾ita u ka¾dého obrázku generovaného touto knihovnou.
\begin{figure}[ht]
\scriptsize\begin{verbatim}                                                                                                  
  BITMAPOVÁ HLAVIÈKA                                   INFORMAÈNÍ HLAVIÈKA

        32 bit      Popis Pole                              32 bit       Popis Pole
     +---------+                                          +---------+
  0  |    |         Typ souboru (0x4D42) - BM          0  |         |    Velikost hlavièky (0x28)
     +---------+                                          +---------+
  1  |         |    Velikost souboru                   1  |         |    ©íøka obrázku (px)
     +---------+                                          +---------+
  2  |    |    |    Rezervováno 1 a 2 (0x00) (0x00)    2  |         |    Vý¹ka obrázku (px)
     +---------+                                          +---------+
  3  |         |    Offset poèátku bit. dat            3  |    |    |    Poèet rovin (0x01), bity na pixel (0x08)
     +---------+                                          +---------+
                                                       4  |         |    Kompresní metoda (0x00) - není pou¾ita
                                                          +---------+
                                                       5  |         |    Velikost bitmapy
                                                          +---------+
                                                       6  |         |    X pixel na metr (0x0B13)
                                                          +---------+
                                                       7  |         |    Y pixel na metr (0x0B13)
                                                          +---------+
                                                       8  |         |    Poèet barev v obrázku (0x00)
                                                          +---------+
                                                       9  |         |    Poèet dùle¾itých barev v obrázku (0x00)
                                                          +---------+
\end{verbatim}
\caption{Pøehled hlavièek obrázku formátu BMP verze 3.}
\label{pic}
\end{figure}
\subsection*{Aplikace}
\normalsize
Aplikace je konzolového charakteru, s u¾ivatelem komunikuje pomocí poèáteèních vstupních parametrù pøíkazové øádky uvedených v tabulce \ref{tab1}.
\begin{table}[ht]
\begin{center}
\begin{tabular}{ r  l  l} 
\rowcolor[gray]{0.9}
\textbf{pøepínaè}	& \textbf{parametr}	& \textbf{popis} \\
-i			& $<$ifile$>$		& vstupní soubor obrázku, pokud parametr není vstup je STDIN \\
-o			& $<$ofile$>$		& výstupní soubor obrázku, pokud parametr není výstup je STDOUT \\
-l			& $<$logfile$>$		& vypí¹e informace o loginu, velikosti vstupního obrázku a výstupního\\
-h			&			& vypí¹e nápovìdu na standardní výstup, ukonèí aplikaci\\ \hline
\end{tabular}
\caption{Pøehled vstupních parametrù pøíkazové øádku.}
\label{tab1}
\end{center} 
\end{table}

Pro zpracování vstupních parametrù byla pou¾ita funkce getop.

\end{document}